# Build Order Service
FROM golang:1.18-alpine AS build-order-service

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o order_service cmd/order_service/main.go

# Build Payment Service
FROM golang:1.18-alpine AS build-payment-service

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o payment_service cmd/payment_service/main.go

# Build Logger Service
FROM golang:1.18-alpine AS build-logger-service

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o logger_service cmd/logger_service/main.go

# Final Stage
FROM alpine:latest

WORKDIR /app

# Copy the built binaries from previous stages
COPY --from=build-order-service /app/order_service /app/order_service
COPY --from=build-payment-service /app/payment_service /app/payment_service
COPY --from=build-logger-service /app/logger_service /app/logger_service

# Default entry point (can be overridden)
ENTRYPOINT ["/app/order_service"]
